
__author__ = 'Danyang'
class Solution:
    def candy(self, ratings):
        
        length = len(ratings)
        dp = [-1 for _ in xrange(length)]
        dp[0] = 1
        for ind in xrange(1, length):
            val = ratings[ind]
            if ratings[ind-1]<val:
                dp[ind] = dp[ind-1]+1
            elif ratings[ind-1]>val:
                dp[ind] = dp[ind-1]-1
            else:
                dp[ind] = 1

            
            if ind+1<length and ratings[ind-1]>val and val<=ratings[ind+1]:
                self.re_adjust(ratings, dp, ind)

        
        if ratings[length-2]>ratings[length-1]:
            self.re_adjust(ratings, dp, length-1)

        return sum(dp)

    def re_adjust(self, ratings, dp, ind):
        
        original = dp[ind]
        if original==1: return  
        i = ind
        candy = 1
        while i>0 and ratings[i-1]>ratings[i]:  
            dp[i] = candy
            candy += 1
            i -= 1
        
        if original<1:  
            dp[i] = candy

if __name__=="_"_"m"a"i"n"_"_"":""
"" "" "" "" ""a""s""s""e""r""t"" ""S""o""l""u""t""i""o""n""("")"".""c""a""n""d""y""(""[""5""8"",""2""1"",""7""2"",""7""7"",""4""8"",""9"",""3""8"",""7""1"",""6""8"",""7""7"",""8""2"",""4""7"",""2""5"",""9""4"",""8""9"",""5""4"",""2""6"",""5""4"",""5""4"",""9""9"",""6""4"",""7""1"",""7""6"",""6""3"",""8""1"",""8""2"",""6""0"",""6""4"",""2""9"",""5""1"",""8""7"",""8""7"",""7""2"",""1""2"",""1""6"",""2""0"",""2""1"",""5""4"",""4""3"",""4""1"",""8""3"",""7""7"",""4""1"",""6""1"",""7""2"",""8""2"",""1""5"",""5""0"",""3""6"",""6""9"",""4""9"",""5""3"",""9""2"",""7""7"",""1""6"",""7""3"",""1""2"",""2""8"",""3""7"",""4""1"",""7""9"",""2""5"",""8""0"",""3"",""3""7"",""4""8"",""2""3"",""1""0"",""5""5"",""1""9"",""5""1"",""3""8"",""9""6"",""9""2"",""9""9"",""6""8"",""7""5"",""1""4"",""1""8"",""6""3"",""3""5"",""1""9"",""6""8"",""2""8"",""4""9"",""3""6"",""5""3"",""6""1"",""6""4"",""9""1"",""2"",""4""3"",""6""8"",""3""4"",""4""6"",""5""7"",""8""2"",""2""2"",""6""7"",""8""9""]"")""=""=""2""0""8""
"" "" "" "" ""a""s""s""e""r""t"" ""S""o""l""u""t""i""o""n""("")"".""c""a""n""d""y""(""[""4"","" ""2"","" ""3"","" ""4"","" ""1""]"")""=""=""9""
"" "" "" "" ""a""s""s""e""r""t"" ""S""o""l""u""t""i""o""n""("")"".""c""a""n""d""y""(""[""1"","" ""4"","" ""3"","" ""2"","" ""1""]"")""=""=""1""1""
"" "" "" "" ""a""s""s""e""r""t"" ""S""o""l""u""t""i""o""n""("")"".""c""a""n""d""y""(""[""8"","" ""7"","" ""6"","" ""5"","" ""4"","" ""3"","" ""2"","" ""1""]"")""=""=""3""6""
